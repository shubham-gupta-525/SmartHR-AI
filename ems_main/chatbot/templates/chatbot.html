<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ShubhamX AI</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
    background: linear-gradient(135deg, #a5cae5, #f5f7fa);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Arial, sans-serif;
}


        .chat-card {
            width: 100%;
            max-width: 800px;
            background: #ffffff;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        .chat-header {
            padding: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            text-align: center;
            border-bottom: 1px solid #ddd;
            background: #f8f9fa;
        }

        .messages {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #fafafa;
        }

        .user, .bot {
            padding: 10px 14px;
            margin-bottom: 10px;
            border-radius: 8px;
            max-width: 75%;
            font-size: 15px;
            line-height: 1.5;
        }

        .user {
            margin-left: auto;
            background: #d1e7ff;
            color: #000;
        }

        .bot {
            background: #e9ecef;
            color: #000;
        }

        .loading {
            font-style: italic;
            color: #666;
        }

        .chat-input {
            padding: 12px;
            border-top: 1px solid #ddd;
            background: #fff;
        }

        .form-control {
            font-size: 15px;
        }

        button {
            min-width: 80px;
        }
    </style>
</head>

<body>
<div class="container">
    <div class="chat-card mx-auto">
        <div class="chat-header">
            ðŸ¤– HR AI Assistant ðŸ¤–
        </div>

        <div id="messages" class="messages"></div>

        <div class="chat-input d-flex gap-2">
            <input type="text" id="userInput" class="form-control"
                   placeholder="Type your message..."
                   onkeypress="if(event.key==='Enter'){sendMessage()}">

            <button class="btn btn-primary" onclick="sendMessage()">Send</button>
            <button class="btn btn-secondary" onclick="clearChat()">Clear</button>
        </div>
    </div>
</div>

<script>
    async function sendMessage() {
        const userInput = document.getElementById("userInput");
        const message = userInput.value.trim();
        if (!message) return;

        const messagesDiv = document.getElementById("messages");
        messagesDiv.innerHTML += `<div class="user"><b>You:</b> ${message}</div>`;
        userInput.value = "";

        const loaderId = "loader-" + Date.now();
        messagesDiv.innerHTML += `<div class="bot loading" id="${loaderId}">Bot is typing...</div>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        try {
            const response = await fetch("/chatbot/chat/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message })
            });

            const data = await response.json();
            document.getElementById(loaderId).remove();

            if (data.reply) {
                const lines = data.reply.split("\n").filter(l => l.trim());
                let html = "";

                lines.forEach(line => {
                    if (line.startsWith("*")) {
                        html += `<li>${line.replace(/^\*+\s*/, "")}</li>`;
                    } else {
                        html += `<p>${line}</p>`;
                    }
                });

                messagesDiv.innerHTML += `
                    <div class="bot">
                        <b>Bot:</b>
                        <ul style="margin:5px 0 0 18px;">${html}</ul>
                    </div>
                `;
            } else {
                messagesDiv.innerHTML += `<div class="bot">Error: ${data.error}</div>`;
            }
        } catch {
            document.getElementById(loaderId).remove();
            messagesDiv.innerHTML += `<div class="bot">Server not reachable</div>`;
        }

        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function clearChat() {
        document.getElementById("messages").innerHTML = "";
    }
</script>
</body>
</html>
